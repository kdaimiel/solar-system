function SceneBuilder(){"use strict";var o,a,t,i,r,n;return{addObject:function(e){o.add(e),a&&(a.aspect=(r||window.innerWidth)/(n||window.innerHeight),a.updateProjectionMatrix())},animate:function e(){if(!o)throw new TypeError("Scene has to be initiated before animate");requestAnimationFrame(e);for(var t in o.children)o.children[t].update&&o.children[t].update(a);i&&i.update();s()},setCamera:function(e){a=e},setControls:function(e){(i=e)&&i.addEventListener&&i.addEventListener("change",s)},init:function(e){o=new THREE.Scene,e&&(r=e.width||null,n=e.height||null);i&&i.addEventListener("change",s);(t=new THREE.WebGLRenderer({alpha:!0})).setSize(r||window.innerWidth,n||window.innerHeight),document.body.appendChild(t.domElement),window.addEventListener("resize",h,!1)}};function s(){t.render(o,a)}function h(){a&&(a.aspect=(r||window.innerWidth)/(n||window.innerHeight),a.updateProjectionMatrix()),t.setSize(r||window.innerWidth,n||window.innerHeight),i&&i.handleResize()}}THREE.SolarBody=function(e){THREE.Object3D.call(this),this.geometry=new THREE.SphereGeometry(5,32,32),this.material=new THREE.MeshBasicMaterial,e&&(this.name=e.name,this.type=e.type,e.map&&this.texloader.load(e.map,this.loadTexture.bind(this)),e.bumpMap&&this.texloader.load(e.bumpMap,this.loadbumpMap.bind(this)),e.specularMap&&this.texloader.load(e.specularMap,this.loadspecularMap.bind(this)),this.orbitProperties=e.orbitProperties,e.cloudsProperties&&this.addClouds(e.cloudsProperties),e.ringsProperties&&this.addRings(e.ringsProperties)),this.drawMode=THREE.TrianglesDrawMode,this.updateMorphTargets()},THREE.SolarBody.prototype=Object.create(THREE.Mesh.prototype),THREE.SolarBody.prototype.constructor=THREE.SolarBody,THREE.SolarBody.prototype.addClouds=function(e){this.add(new THREE.CloudsMesh(e))},THREE.SolarBody.prototype.addRings=function(e){this.add(new THREE.RingsMesh(e))},THREE.SolarBody.prototype.addSatellite=function(e){var t=new THREE.OrbitMesh(e.orbitProperties);e.orbit=t,this.orbit?(this.orbit.add(t),t.position.z=this.position.z||0):this.parent&&this.parent.add(t),t.add(e),e.position.z=this.radius+t.distance+e.radius||0},THREE.SolarBody.prototype.loadTexture=function(e){this.material=new THREE.MeshPhongMaterial({map:e,side:THREE.DoubleSide})},THREE.SolarBody.prototype.loadbumpMap=function(e){this.material.bumpMap=e},THREE.SolarBody.prototype.loadspecularMap=function(e){this.material.specularMap=e},THREE.SolarBody.prototype.update=function(e){for(var t in this.rotation.y-=this.vRotation*Math.PI/180,this.children)this.children[t].update(e,this)},THREE.SolarBody.prototype.texloader=new THREE.TextureLoader,THREE.PlanetMesh=function(e){THREE.SolarBody.call(this,e),this.type=e&&e.type||"PlanetMesh",this.radius=e&&e.radius||50,this.rotation.x=e&&e.tilt||0,this.vRotation=e&&e.vRotation||0,this.geometry=new THREE.SphereGeometry(this.radius||50,100,100)},THREE.PlanetMesh.prototype=Object.create(THREE.SolarBody.prototype),THREE.PlanetMesh.prototype.constructor=THREE.PlanetMesh;var SceneFactory=function(){"use strict";return{createCamera:function(e){var t;switch(e.aspect=e.aspect||window.innerWidth/window.innerHeight,e.type){case"PerspectiveCamera":t=new THREE.PerspectiveCamera(e.fov,e.aspect,e.near,e.far);break;case"CubeCamera":t=new THREE.CubeCamera(e.near,e.far,e.cubeResolution);break;case"OrthographicCamera":t=new THREE.OrthographicCamera(e.left,e.right,e.top,e.bottom,e.near,e.far);break;default:throw new TypeError(e.type+" is not a kind of valid camera")}return e.position&&(t.position.x=e.position.x||0,t.position.y=e.position.y||0,t.position.z=e.position.z||0),t.zoom=e.zoom||1,t},createControls:function(e,t){var o;switch(t){case"TrackballControls":o=new THREE.TrackballControls(e);break;case"DeviceOrientationControls":o=new THREE.DeviceOrientationControls(e);break;case"FlyControls":o=new THREE.FlyControls(e);break;case"OrbitControls":o=new THREE.OrbitControls(e);break;case"PointerLockControls":o=new THREE.PointerLockControls(e);break;case"TransformControls":o=new THREE.TransformControls(e);break;default:throw new TypeError(t+" is not a kind of valid camera controls")}return o},createLight:function(e){var t,o=new THREE.Color(e.hexColor)||16777215;switch(e.type){case"AmbientLight":t=new THREE.AmbientLight(o);break;case"DirectionalLight":t=new THREE.DirectionalLight(o,e.intensity||.5);break;case"HemisphereLight":t=new THREE.HemisphereLight(e.skyColor||16777147,e.groundColor||526368,e.intensity||1);break;case"PointLight":t=new THREE.PointLight(o,e.intensity||1,e.distance||0,e.decay||1);break;case"SpotLight":(t=new THREE.SpotLight(o,e.intensity||1,e.distance||0,e.angle||Math.PI/3,e.exponent||10,e.decay||1)).castShadow=e.castShadow||!1,t.shadow.camera.near=e.shadowCameraNear||50,t.shadow.camera.far=e.shadowCameraFar||5e3,t.shadow.camera.left=e.shadowCameraLeft||-500,t.shadow.camera.right=e.shadowCameraRight||500,t.shadow.camera.top=e.shadowCameraTop||500,t.shadow.camera.bottom=e.shadowCameraBottom||-500,e.shadowCameraVisible&&THREE.CameraHelper(t.shadow.camera),t.shadow.bias=e.shadowBias||0,t.shadow.mapSize.width=e.shadowMapWidth||512,t.shadow.mapSize.height=e.shadowMapHeight||512,t.shadowMapSize=e.shadowMapSize,t.shadowCamera=e.shadowCamera,t.shadowMatrix=e.shadowMatrix,t.shadowMap=e.shadowMap;break;default:throw new TypeError(e.type+" is not a kind of valid light")}return e.position&&t.position.set(e.position.x||0,e.position.y||0,e.position.z||0),t}}}(),SolarFactory=function(){"use strict";return{createMoon:function(e){return new THREE.MoonMesh(e)},createPlanet:function(e){return new THREE.PlanetMesh(e)},createStar:function(e){return new THREE.StarMesh(e)}}}();function SolarProperties(e){"use strict";return{width:e&&e.width,height:e&&e.height,bodiesSrc:e&&e.bodiesSrc||"data/bodies.properties.json",cameraSrc:e&&e.cameraSrc||"data/camera.properties.json",lightsSrc:e&&e.lightsSrc||"data/lights.properties.json"}}var SolarService=function(){"use strict";function o(t,e){var o=new XMLHttpRequest;o.onreadystatechange=function(){4===o.readyState&&(200===o.status?e(JSON.parse(o.responseText)):400<=o.status&&console.error("Load "+t+" error, status: "+o.status))},o.onerror=function(e){console.error("Load "+t+" error :"+JSON.stringify(e,null,"  "))},o.open("GET",t,!0),o.send(null)}return{getCamera:function(e,t){o(e,t)},getBodies:function(e,t){o(e,t)},getLights:function(e,t){o(e,t)}}}();function SolarSystem(){"use strict";var t,o={},e={addMoon:r,addPlanet:n,addStar:s,init:function(e){t=new SolarProperties(e),a.init(t),SolarService.getCamera(t.cameraSrc,h),SolarService.getBodies(t.bodiesSrc,d),SolarService.getLights(t.lightsSrc,c)}},a=new SceneBuilder;return e;function i(e){(o[e.name]=e).orbitProperties?o[e.orbitProperties.round].addSatellite(e):a.addObject(e)}function r(e){i(SolarFactory.createMoon(e))}function n(e){i(SolarFactory.createPlanet(e))}function s(e){i(SolarFactory.createStar(e))}function h(e){var t=SceneFactory.createCamera(e);a.setCamera(t);var o=SceneFactory.createControls(t,e.controls);a.setControls(o),a.animate()}function d(e){e.forEach(function(e){switch(e.type){case"Star":s(e);break;case"Planet":case"Dwarf Planet":n(e);break;case"Moon":r(e);break;default:return void console.error(e.type+" is not considered a kind of solar body")}})}function c(e){e.forEach(function(e){var t=SceneFactory.createLight(e);a.addObject(t)})}}THREE.RingsGeometry=function(e,t,o,a,i,r){THREE.Geometry.call(this),this.type="RingsGeometry",this.innerRadius=e||0,this.outerRadius=t||50,this.thetaStart=void 0!==o?o:0,this.thetaLength=void 0!==a?a:2*Math.PI,this.thetaSegments=void 0!==i?Math.max(3,i):50,this.phiSegments=void 0!==r?Math.max(1,r):50;var n,s,h,d=[],c=this.innerRadius,E=(t-e)/this.phiSegments;for(n=0;n<this.phiSegments+1;n++){for(s=0;s<this.thetaSegments+1;s++){var p=new THREE.Vector3;h=this.thetaStart+s/this.thetaSegments*this.thetaLength,p.x=c*Math.cos(h),p.y=c*Math.sin(h),this.vertices.push(p),d.push(new THREE.Vector2(n/(this.thetaSegments-1),s/(this.phiSegments-1)))}c+=E}var l=new THREE.Vector3(0,0,1);for(n=0;n<this.phiSegments;n++){var u=n*(this.thetaSegments+1);for(s=0;s<this.thetaSegments;s++){var R=h=s+u,T=h+this.thetaSegments+1,y=h+this.thetaSegments+2;this.faces.push(new THREE.Face3(R,T,y,[l.clone(),l.clone(),l.clone()])),this.faceVertexUvs[0].push([d[R].clone(),d[T].clone(),d[y].clone()]),T=(R=h)+this.thetaSegments+2,y=h+1,this.faces.push(new THREE.Face3(R,T,y,[l.clone(),l.clone(),l.clone()])),this.faceVertexUvs[0].push([d[R].clone(),d[T].clone(),d[y].clone()])}}this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,c)},THREE.RingsGeometry.prototype=Object.create(THREE.RingGeometry.prototype),THREE.RingsGeometry.prototype.constructor=THREE.RingsGeometry,THREE.CloudsMesh=function(e){THREE.SolarBody.call(this,e),this.type=e&&e.type||"CloudsMesh",this.radius=e&&e.radius||20,this.opacity=e&&e.opacity||.5,this.transparent=e&&e.transparent||!0,this.depthWrite=e&&e.depthWrite||!1,this.speed=e&&e.speed||.2,this.geometry=new THREE.SphereGeometry(this.radius,100,100)},THREE.CloudsMesh.prototype=Object.create(THREE.SolarBody.prototype),THREE.CloudsMesh.prototype.constructor=THREE.CloudsMesh,THREE.CloudsMesh.prototype.loadTexture=function(e){this.material=new THREE.MeshPhongMaterial({map:e,side:THREE.DoubleSide,opacity:this.opacity,transparent:this.transparent,depthWrite:this.depthWrite})},THREE.CloudsMesh.prototype.update=function(){this.rotation.x-=THREE.Math.randFloat(0,this.speed)*Math.PI/180,this.rotation.y-=THREE.Math.randFloat(0,this.speed)*Math.PI/180},THREE.MoonMesh=function(e){this.type=e&&e.type||"MoonMesh",THREE.PlanetMesh.call(this,e)},THREE.MoonMesh.prototype=Object.create(THREE.PlanetMesh.prototype),THREE.MoonMesh.prototype.constructor=THREE.MoonMesh,THREE.OrbitMesh=function(e){THREE.Object3D.call(this),this.name=e&&e.name,this.type=e&&e.type||"OrbitMesh",this.distance=e&&e.distance||50,this.speed=e&&e.speed||0,this.tilt=e&&e.tilt||0},THREE.OrbitMesh.prototype=Object.create(THREE.Object3D.prototype),THREE.OrbitMesh.prototype.constructor=THREE.OrbitMesh,THREE.OrbitMesh.prototype.update=function(){for(var e in this.rotation.y-=this.speed*Math.PI/180,this.children)this.children[e].update()},THREE.RingsMesh=function(e){THREE.SolarBody.call(this,e),this.type=e&&e.type||"RingsMesh",this.tilt=e&&e.tilt||0,this.rotation.x=(90-this.tilt)*Math.PI/180,this.vRotation=e&&e.vRotation||0,this.geometry=new THREE.RingsGeometry(e&&e.innerRadius,e&&e.outerRadius,e&&e.thetaStart,e&&e.thetaLength,e&&e.thetaSegments,e&&e.phiSegments)},THREE.RingsMesh.prototype=Object.create(THREE.SolarBody.prototype),THREE.RingsMesh.prototype.constructor=THREE.RingsMesh,THREE.RingsMesh.prototype.update=function(){this.rotation.y-=this.vRotation*Math.PI/180},THREE.RingsMesh.prototype.loadTexture=function(e){this.material=new THREE.MeshPhongMaterial({map:e,side:THREE.DoubleSide})},THREE.StarMesh=function(e){THREE.SolarBody.call(this,e),this.type=e&&e.type||"StarMesh",this.radius=e&&e.radius||50,this.rotation.x=e&&e.tilt||0,this.vRotation=e&&e.vRotation||0,this.intensity=e&&e.intensity||.8,this.geometry=new THREE.SphereGeometry(this.radius||50,100,100),this.createLensFlare()},THREE.StarMesh.prototype=Object.create(THREE.SolarBody.prototype),THREE.StarMesh.prototype.constructor=THREE.StarMesh,THREE.StarMesh.prototype.createLensFlare=function(){var e=2*this.radius*this.intensity,t=new THREE.Color(16777215),o=new THREE.TextureLoader,a=o.load("img/sun/lensflare1.png"),i=o.load("img/sun/lensflare2.png"),r=o.load("img/sun/lensflare3.png"),n=o.load("img/sun/lensflare4.png"),s=new THREE.Lensflare;s.addElement(new THREE.LensflareElement(a,16*e,0,t,THREE.AdditiveBlending)),s.addElement(new THREE.LensflareElement(i,16*e,0,t,THREE.AdditiveBlending)),s.addElement(new THREE.LensflareElement(r,16*e,0,t,THREE.AdditiveBlending)),s.addElement(new THREE.LensflareElement(n,64*e,0,t,THREE.AdditiveBlending)),s.position=this.position,s.update=function(e,t){if(e){var o=e.position.distanceTo(t.position);for(var a in this.lensFlares)this.lensFlares[a].position=t.position,this.lensFlares[a].scale=this.lensFlares[a].size/o}};var h=new THREE.PointLight(t,1.5,4500);h.update=function(e){for(var t in h.children)h.children[t].update&&h.children[t].update(e)},h.add(s),this.add(h),this.add(s),this.hasLensFlare=!0},THREE.StarMesh.prototype.loadTexture=function(e){this.material=new THREE.MeshBasicMaterial({map:e,side:THREE.BackSide})};