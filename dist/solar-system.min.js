"use strict";function SceneBuilder(){var o,r,n,i,a,s;return{addObject:function(t){o.add(t),r&&(r.aspect=(a||window.innerWidth)/(s||window.innerHeight),r.updateProjectionMatrix())},animate:function t(){if(!o)throw new TypeError("Scene has to be initiated before animate");requestAnimationFrame(t);for(var e in o.children)o.children[e].update&&o.children[e].update(r);i&&i.update();c()},getRenderer:function(){return n},setCamera:function(t){r=t},setControls:function(t){(i=t)&&i.addEventListener&&i.addEventListener("change",c)},init:function(t,e){o=new THREE.Scene,t&&(a=t.width||null,s=t.height||null);i&&i.addEventListener("change",c);(n=new THREE.WebGLRenderer({alpha:!0})).setSize(a||window.innerWidth,s||window.innerHeight),e?e.appendChild(n.domElement):document.body.appendChild(n.domElement);window.addEventListener("resize",h,!1)}};function c(){n.render(o,r)}function h(){r&&(r.aspect=(a||window.innerWidth)/(s||window.innerHeight),r.updateProjectionMatrix()),n.setSize(a||window.innerWidth,s||window.innerHeight),i&&i.handleResize()}}THREE.SolarBody=function(t){THREE.Object3D.call(this),this.geometry=new THREE.SphereGeometry(5,32,32),this.material=new THREE.MeshBasicMaterial,t&&(this.name=t.name,this.type=t.type,t.map&&this.texloader.load(t.map,this.loadTexture.bind(this)),t.bumpMap&&this.texloader.load(t.bumpMap,this.loadbumpMap.bind(this)),t.specularMap&&this.texloader.load(t.specularMap,this.loadspecularMap.bind(this)),this.orbitProperties=t.orbitProperties,t.cloudsProperties&&this.addClouds(t.cloudsProperties),t.ringsProperties&&this.addRings(t.ringsProperties)),this.updateMorphTargets()},THREE.SolarBody.prototype=Object.create(THREE.Mesh.prototype),THREE.SolarBody.prototype.constructor=THREE.SolarBody,THREE.SolarBody.prototype.addClouds=function(t){this.add(new THREE.CloudsMesh(t))},THREE.SolarBody.prototype.addRings=function(t){this.add(new THREE.RingsMesh(t))},THREE.SolarBody.prototype.addSatellite=function(t){var e=new THREE.OrbitMesh(t.orbitProperties);t.orbit=e,this.orbit?(this.orbit.add(e),e.position.z=this.position.z||0):this.parent&&this.parent.add(e),e.add(t),t.position.z=this.radius+e.distance+t.radius||0},THREE.SolarBody.prototype.loadTexture=function(t){this.material=new THREE.MeshPhongMaterial({map:t,side:THREE.DoubleSide})},THREE.SolarBody.prototype.loadbumpMap=function(t){this.material.bumpMap=t},THREE.SolarBody.prototype.loadspecularMap=function(t){this.material.specularMap=t},THREE.SolarBody.prototype.update=function(t){for(var e in this.rotation.y-=this.vRotation*Math.PI/180,this.children)this.children[e].update(t,this)},THREE.SolarBody.prototype.texloader=new THREE.TextureLoader,THREE.PlanetMesh=function(t){THREE.SolarBody.call(this,t),this.type=t&&t.type||"PlanetMesh",this.radius=t&&t.radius||50,this.rotation.x=t&&t.tilt||0,this.vRotation=t&&t.vRotation||0,this.geometry=new THREE.SphereGeometry(this.radius||50,100,100)},THREE.PlanetMesh.prototype=Object.create(THREE.SolarBody.prototype),THREE.PlanetMesh.prototype.constructor=THREE.PlanetMesh;var SceneFactory={createCamera:function(t){switch(t.aspect=t.aspect||window.innerWidth/window.innerHeight,t.type){case"PerspectiveCamera":o=new THREE.PerspectiveCamera(t.fov,t.aspect,t.near,t.far);break;case"CubeCamera":var e=new THREE.WebGLCubeRenderTarget(t.cubeResolution||258,t.options||{format:THREE.RGBFormat,generateMipmaps:!0,minFilter:THREE.LinearMipmapLinearFilter}),o=new THREE.CubeCamera(t.near,t.far,e);break;case"OrthographicCamera":o=new THREE.OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far);break;default:throw new TypeError(t.type+" is not a kind of valid camera")}return t.position&&(o.position.x=t.position.x||0,o.position.y=t.position.y||0,o.position.z=t.position.z||0),o.zoom=t.zoom||1,o},createControls:function(t,e,o){var r;switch(e){case"TrackballControls":r=new THREE.TrackballControls(t,o&&o.domElement);break;case"DeviceOrientationControls":r=new THREE.DeviceOrientationControls(t,o&&o.domElement);break;case"FlyControls":r=new THREE.FlyControls(t,o&&o.domElement);break;case"OrbitControls":r=new THREE.OrbitControls(t,o&&o.domElement);break;case"PointerLockControls":r=new THREE.PointerLockControls(t,o&&o.domElement);break;case"TransformControls":r=new THREE.TransformControls(t,o&&o.domElement);break;default:throw new TypeError(e+" is not a kind of valid camera controls")}return r},createLight:function(t){var e,o=new THREE.Color(t.hexColor)||16777215;switch(t.type){case"AmbientLight":e=new THREE.AmbientLight(o);break;case"DirectionalLight":e=new THREE.DirectionalLight(o,t.intensity||.5);break;case"HemisphereLight":e=new THREE.HemisphereLight(t.skyColor||16777147,t.groundColor||526368,t.intensity||1);break;case"PointLight":e=new THREE.PointLight(o,t.intensity||1,t.distance||0,t.decay||1);break;case"SpotLight":(e=new THREE.SpotLight(o,t.intensity||1,t.distance||0,t.angle||Math.PI/3,t.exponent||10,t.decay||1)).castShadow=t.castShadow||!1,e.shadow.camera.near=t.shadowCameraNear||50,e.shadow.camera.far=t.shadowCameraFar||5e3,e.shadow.camera.left=t.shadowCameraLeft||-500,e.shadow.camera.right=t.shadowCameraRight||500,e.shadow.camera.top=t.shadowCameraTop||500,e.shadow.camera.bottom=t.shadowCameraBottom||-500,t.shadowCameraVisible&&THREE.CameraHelper(e.shadow.camera),e.shadow.bias=t.shadowBias||0,e.shadow.mapSize.width=t.shadowMapWidth||512,e.shadow.mapSize.height=t.shadowMapHeight||512,e.shadowMapSize=t.shadowMapSize,e.shadowCamera=t.shadowCamera,e.shadowMatrix=t.shadowMatrix,e.shadowMap=t.shadowMap;break;default:throw new TypeError(t.type+" is not a kind of valid light")}return t.position&&e.position.set(t.position.x||0,t.position.y||0,t.position.z||0),e}},SolarFactory={createMoon:function(t){return new THREE.MoonMesh(t)},createPlanet:function(t){return new THREE.PlanetMesh(t)},createStar:function(t){return new THREE.StarMesh(t)}};function SolarProperties(t){return{width:t&&t.width,height:t&&t.height,bodiesSrc:t&&t.bodiesSrc||"data/bodies.properties.json",cameraSrc:t&&t.cameraSrc||"data/camera.properties.json",lightsSrc:t&&t.lightsSrc||"data/lights.properties.json"}}var SolarService=function(){function o(e,t){var o=new XMLHttpRequest;o.onreadystatechange=function(){4===o.readyState&&(200===o.status?t(JSON.parse(o.responseText)):400<=o.status&&console.error("Load "+e+" error, status: "+o.status))},o.onerror=function(t){console.error("Load "+e+" error :"+JSON.stringify(t,null,"  "))},o.open("GET",e,!0),o.send(null)}return{getCamera:function(t,e){o(t,e)},getBodies:function(t,e){o(t,e)},getLights:function(t,e){o(t,e)}}}();function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _createClass(t,e,o){return e&&_defineProperties(t.prototype,e),o&&_defineProperties(t,o),t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _createSuper(o){var r=_isNativeReflectConstruct();return function(){var t,e=_getPrototypeOf(o);return _possibleConstructorReturn(this,r?(t=_getPrototypeOf(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _wrapNativeSuper(t){var o="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(t){if(null===t||!_isNativeFunction(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==o){if(o.has(t))return o.get(t);o.set(t,e)}function e(){return _construct(t,arguments,_getPrototypeOf(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(e,t)})(t)}function _construct(t,e,o){return(_construct=_isNativeReflectConstruct()?Reflect.construct:function(t,e,o){var r=[null];r.push.apply(r,e);var n=new(Function.bind.apply(t,r));return o&&_setPrototypeOf(n,o.prototype),n}).apply(null,arguments)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function _isNativeFunction(t){return-1!==Function.toString.call(t).indexOf("[native code]")}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function SolarSystem(){var o,e={},t={addMoon:i,addPlanet:a,addStar:s,init:function(t,e){o=new SolarProperties(t),n.init(o,e),SolarService.getCamera(o.cameraSrc,c),SolarService.getBodies(o.bodiesSrc,h),SolarService.getLights(o.lightsSrc,p)}},n=new SceneBuilder;return t;function r(t){(e[t.name]=t).orbitProperties?e[t.orbitProperties.round].addSatellite(t):n.addObject(t)}function i(t){r(SolarFactory.createMoon(t))}function a(t){r(SolarFactory.createPlanet(t))}function s(t){r(SolarFactory.createStar(t))}function c(t){var e=SceneFactory.createCamera(t);n.setCamera(e);var o=n.getRenderer(),r=SceneFactory.createControls(e,t.controls,o);n.setControls(r),n.animate()}function h(t){t.forEach(function(t){switch(t.type){case"Star":s(t);break;case"Planet":case"Dwarf Planet":a(t);break;case"Moon":i(t);break;default:return void console.error(t.type+" is not considered a kind of solar body")}})}function p(t){t.forEach(function(t){var e=SceneFactory.createLight(t);n.addObject(e)})}}window.customElements.define("solar-system",function(){_inherits(e,_wrapNativeSuper(HTMLElement));var t=_createSuper(e);function e(){return _classCallCheck(this,e),t.call(this)}return _createClass(e,[{key:"connectedCallback",value:function(){(new SolarSystem).init(this,this)}},{key:"width",get:function(){return this.getAttribute("width")}},{key:"height",get:function(){return this.getAttribute("height")}},{key:"bodiesSrc",get:function(){return this.getAttribute("bodies-src")}},{key:"cameraSrc",get:function(){return this.getAttribute("camera-src")}},{key:"lightsSrc",get:function(){return this.getAttribute("lights-src")}}]),e}()),THREE.RingsGeometry=function(t,e,o,r,n,i){THREE.Geometry.call(this),this.type="RingsGeometry",this.innerRadius=t||0,this.outerRadius=e||50,this.thetaStart=void 0!==o?o:0,this.thetaLength=void 0!==r?r:2*Math.PI,this.thetaSegments=void 0!==n?Math.max(3,n):50,this.phiSegments=void 0!==i?Math.max(1,i):50;for(var a=[],s=this.innerRadius,c=(e-t)/this.phiSegments,h=0;h<this.phiSegments+1;h++){for(E=0;E<this.thetaSegments+1;E++){var p=new THREE.Vector3,l=this.thetaStart+E/this.thetaSegments*this.thetaLength;p.x=s*Math.cos(l),p.y=s*Math.sin(l),this.vertices.push(p),a.push(new THREE.Vector2(h/(this.thetaSegments-1),E/(this.phiSegments-1)))}s+=c}var d=new THREE.Vector3(0,0,1);for(h=0;h<this.phiSegments;h++)for(var u=h*(this.thetaSegments+1),E=0;E<this.thetaSegments;E++){var f=l=E+u,y=l+this.thetaSegments+1,R=l+this.thetaSegments+2;this.faces.push(new THREE.Face3(f,y,R,[d.clone(),d.clone(),d.clone()])),this.faceVertexUvs[0].push([a[f].clone(),a[y].clone(),a[R].clone()]),y=(f=l)+this.thetaSegments+2,R=l+1,this.faces.push(new THREE.Face3(f,y,R,[d.clone(),d.clone(),d.clone()])),this.faceVertexUvs[0].push([a[f].clone(),a[y].clone(),a[R].clone()])}this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,s)},THREE.RingsGeometry.prototype=Object.create(THREE.RingGeometry.prototype),THREE.RingsGeometry.prototype.constructor=THREE.RingsGeometry,THREE.CloudsMesh=function(t){THREE.SolarBody.call(this,t),this.type=t&&t.type||"CloudsMesh",this.radius=t&&t.radius||20,this.opacity=t&&t.opacity||.5,this.transparent=t&&t.transparent||!0,this.depthWrite=t&&t.depthWrite||!1,this.speed=t&&t.speed||.2,this.geometry=new THREE.SphereGeometry(this.radius,100,100)},THREE.CloudsMesh.prototype=Object.create(THREE.SolarBody.prototype),THREE.CloudsMesh.prototype.constructor=THREE.CloudsMesh,THREE.CloudsMesh.prototype.loadTexture=function(t){this.material=new THREE.MeshPhongMaterial({map:t,side:THREE.DoubleSide,opacity:this.opacity,transparent:this.transparent,depthWrite:this.depthWrite})},THREE.CloudsMesh.prototype.update=function(){this.rotation.x-=THREE.Math.randFloat(0,this.speed)*Math.PI/180,this.rotation.y-=THREE.Math.randFloat(0,this.speed)*Math.PI/180},THREE.MoonMesh=function(t){this.type=t&&t.type||"MoonMesh",THREE.PlanetMesh.call(this,t)},THREE.MoonMesh.prototype=Object.create(THREE.PlanetMesh.prototype),THREE.MoonMesh.prototype.constructor=THREE.MoonMesh,THREE.OrbitMesh=function(t){THREE.Object3D.call(this),this.name=t&&t.name,this.type=t&&t.type||"OrbitMesh",this.distance=t&&t.distance||50,this.speed=t&&t.speed||0,this.tilt=t&&t.tilt||0},THREE.OrbitMesh.prototype=Object.create(THREE.Object3D.prototype),THREE.OrbitMesh.prototype.constructor=THREE.OrbitMesh,THREE.OrbitMesh.prototype.update=function(){for(var t in this.rotation.y-=this.speed*Math.PI/180,this.children)this.children[t].update()},THREE.RingsMesh=function(t){THREE.SolarBody.call(this,t),this.type=t&&t.type||"RingsMesh",this.tilt=t&&t.tilt||0,this.rotation.x=(90-this.tilt)*Math.PI/180,this.vRotation=t&&t.vRotation||0,this.geometry=new THREE.RingsGeometry(t&&t.innerRadius,t&&t.outerRadius,t&&t.thetaStart,t&&t.thetaLength,t&&t.thetaSegments,t&&t.phiSegments)},THREE.RingsMesh.prototype=Object.create(THREE.SolarBody.prototype),THREE.RingsMesh.prototype.constructor=THREE.RingsMesh,THREE.RingsMesh.prototype.update=function(){this.rotation.y-=this.vRotation*Math.PI/180},THREE.RingsMesh.prototype.loadTexture=function(t){this.material=new THREE.MeshPhongMaterial({map:t,side:THREE.DoubleSide})},THREE.StarMesh=function(t){THREE.SolarBody.call(this,t),this.type=t&&t.type||"StarMesh",this.radius=t&&t.radius||50,this.rotation.x=t&&t.tilt||0,this.vRotation=t&&t.vRotation||0,this.intensity=t&&t.intensity||.8,this.geometry=new THREE.SphereGeometry(this.radius||50,100,100),this.createLensFlare()},THREE.StarMesh.prototype=Object.create(THREE.SolarBody.prototype),THREE.StarMesh.prototype.constructor=THREE.StarMesh,THREE.StarMesh.prototype.createLensFlare=function(){var t=2*this.radius*this.intensity,e=new THREE.Color(16777215),o=new THREE.TextureLoader,r=o.load("img/sun/lensflare1.png"),n=o.load("img/sun/lensflare2.png"),i=o.load("img/sun/lensflare3.png"),a=o.load("img/sun/lensflare4.png"),s=new THREE.Lensflare;s.addElement(new THREE.LensflareElement(r,16*t,0,e,THREE.AdditiveBlending)),s.addElement(new THREE.LensflareElement(n,16*t,0,e,THREE.AdditiveBlending)),s.addElement(new THREE.LensflareElement(i,16*t,0,e,THREE.AdditiveBlending)),s.addElement(new THREE.LensflareElement(a,64*t,0,e,THREE.AdditiveBlending)),s.update=function(t,e){if(t){var o=t.position.distanceTo(e.position);for(var r in this.lensFlares)this.lensFlares[r].position=e.position,this.lensFlares[r].scale=this.lensFlares[r].size/o}};var c=new THREE.PointLight(e,1.5,4500);c.update=function(t){for(var e in c.children)c.children[e].update&&c.children[e].update(t)},c.add(s),this.add(c),this.add(s),this.hasLensFlare=!0},THREE.StarMesh.prototype.loadTexture=function(t){this.material=new THREE.MeshBasicMaterial({map:t,side:THREE.BackSide})};