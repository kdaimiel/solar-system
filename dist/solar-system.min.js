function SceneBuilder(){"use strict";var o,i,e,a,r,n;return{addObject:function(t){o.add(t),i&&(i.aspect=(r||window.innerWidth)/(n||window.innerHeight),i.updateProjectionMatrix())},animate:function t(){if(!o)throw new TypeError("Scene has to be initiated before animate");requestAnimationFrame(t);for(var e in o.children)o.children[e].update&&o.children[e].update(i);a&&a.update();s()},setCamera:function(t){i=t},setControls:function(t){(a=t)&&a.addEventListener&&a.addEventListener("change",s)},init:function(t){o=new THREE.Scene,t&&(r=t.width||null,n=t.height||null);a&&a.addEventListener("change",s);(e=new THREE.WebGLRenderer({alpha:!0})).setSize(r||window.innerWidth,n||window.innerHeight),document.body.appendChild(e.domElement),window.addEventListener("resize",h,!1)}};function s(){e.render(o,i)}function h(){i&&(i.aspect=(r||window.innerWidth)/(n||window.innerHeight),i.updateProjectionMatrix()),e.setSize(r||window.innerWidth,n||window.innerHeight),a&&a.handleResize()}}THREE.SolarBody=function(t){THREE.Object3D.call(this),this.geometry=new THREE.SphereGeometry(5,32,32),this.material=new THREE.MeshBasicMaterial,t&&(this.name=t.name,this.type=t.type,t.map&&this.texloader.load(t.map,this.loadTexture.bind(this)),t.bumpMap&&this.texloader.load(t.bumpMap,this.loadbumpMap.bind(this)),t.specularMap&&this.texloader.load(t.specularMap,this.loadspecularMap.bind(this)),this.orbitProperties=t.orbitProperties,t.cloudsProperties&&this.addClouds(t.cloudsProperties),t.ringsProperties&&this.addRings(t.ringsProperties)),this.drawMode=THREE.TrianglesDrawMode,this.updateMorphTargets()},THREE.SolarBody.prototype=Object.create(THREE.Mesh.prototype),THREE.SolarBody.prototype.constructor=THREE.SolarBody,THREE.SolarBody.prototype.addClouds=function(t){this.add(new THREE.CloudsMesh(t))},THREE.SolarBody.prototype.addRings=function(t){this.add(new THREE.RingsMesh(t))},THREE.SolarBody.prototype.addSatellite=function(t){var e=new THREE.OrbitMesh(t.orbitProperties);t.orbit=e,this.orbit?(this.orbit.add(e),e.position.z=this.position.z||0):this.parent&&this.parent.add(e),e.add(t),t.position.z=this.radius+e.distance+t.radius||0},THREE.SolarBody.prototype.loadTexture=function(t){this.material=new THREE.MeshPhongMaterial({map:t,side:THREE.DoubleSide})},THREE.SolarBody.prototype.loadbumpMap=function(t){this.material.bumpMap=t},THREE.SolarBody.prototype.loadspecularMap=function(t){this.material.specularMap=t},THREE.SolarBody.prototype.update=function(t){for(var e in this.rotation.y-=this.vRotation*Math.PI/180,this.children)this.children[e].update(t,this)},THREE.SolarBody.prototype.texloader=new THREE.TextureLoader,THREE.PlanetMesh=function(t){THREE.SolarBody.call(this,t),this.type=t&&t.type||"PlanetMesh",this.radius=t&&t.radius||50,this.rotation.x=t&&t.tilt||0,this.vRotation=t&&t.vRotation||0,this.geometry=new THREE.SphereGeometry(this.radius||50,100,100)},THREE.PlanetMesh.prototype=Object.create(THREE.SolarBody.prototype),THREE.PlanetMesh.prototype.constructor=THREE.PlanetMesh;var SceneFactory=function(){"use strict";return{createCamera:function(t){var e;switch(t.aspect=t.aspect||window.innerWidth/window.innerHeight,t.type){case"PerspectiveCamera":e=new THREE.PerspectiveCamera(t.fov,t.aspect,t.near,t.far);break;case"CubeCamera":e=new THREE.CubeCamera(t.near,t.far,t.cubeResolution);break;case"OrthographicCamera":e=new THREE.OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far);break;default:throw new TypeError(t.type+" is not a kind of valid camera")}return t.position&&(e.position.x=t.position.x||0,e.position.y=t.position.y||0,e.position.z=t.position.z||0),e.zoom=t.zoom||1,e},createControls:function(t,e){var o;switch(e){case"TrackballControls":o=new THREE.TrackballControls(t);break;case"DeviceOrientationControls":o=new THREE.DeviceOrientationControls(t);break;case"FlyControls":o=new THREE.FlyControls(t);break;case"OrbitControls":o=new THREE.OrbitControls(t);break;case"PointerLockControls":o=new THREE.PointerLockControls(t);break;case"TransformControls":o=new THREE.TransformControls(t);break;default:throw new TypeError(e+" is not a kind of valid camera controls")}return o},createLight:function(t){var e,o=new THREE.Color(t.hexColor)||16777215;switch(t.type){case"AmbientLight":e=new THREE.AmbientLight(o);break;case"DirectionalLight":e=new THREE.DirectionalLight(o,t.intensity||.5);break;case"HemisphereLight":e=new THREE.HemisphereLight(t.skyColor||16777147,t.groundColor||526368,t.intensity||1);break;case"PointLight":e=new THREE.PointLight(o,t.intensity||1,t.distance||0,t.decay||1);break;case"SpotLight":(e=new THREE.SpotLight(o,t.intensity||1,t.distance||0,t.angle||Math.PI/3,t.exponent||10,t.decay||1)).castShadow=t.castShadow||!1,e.shadow.camera.near=t.shadowCameraNear||50,e.shadow.camera.far=t.shadowCameraFar||5e3,e.shadow.camera.left=t.shadowCameraLeft||-500,e.shadow.camera.right=t.shadowCameraRight||500,e.shadow.camera.top=t.shadowCameraTop||500,e.shadow.camera.bottom=t.shadowCameraBottom||-500,t.shadowCameraVisible&&THREE.CameraHelper(e.shadow.camera),e.shadow.bias=t.shadowBias||0,e.shadow.mapSize.width=t.shadowMapWidth||512,e.shadow.mapSize.height=t.shadowMapHeight||512,e.shadowMapSize=t.shadowMapSize,e.shadowCamera=t.shadowCamera,e.shadowMatrix=t.shadowMatrix,e.shadowMap=t.shadowMap;break;default:throw new TypeError(t.type+" is not a kind of valid light")}return t.position&&e.position.set(t.position.x||0,t.position.y||0,t.position.z||0),e}}}(),SolarFactory=function(){"use strict";return{createMoon:function(t){return new THREE.MoonMesh(t)},createPlanet:function(t){return new THREE.PlanetMesh(t)},createStar:function(t){return new THREE.StarMesh(t)}}}();function SolarProperties(t){"use strict";return{width:t&&t.width,height:t&&t.height,bodiesSrc:t&&t.bodiesSrc||"data/bodies.properties.json",cameraSrc:t&&t.cameraSrc||"data/camera.properties.json",lightsSrc:t&&t.lightsSrc||"data/lights.properties.json"}}var SolarService=function(){"use strict";function o(e,t){var o=new XMLHttpRequest;o.onreadystatechange=function(){4===o.readyState&&(200===o.status?t(JSON.parse(o.responseText)):400<=o.status&&console.error("Load "+e+" error, status: "+o.status))},o.onerror=function(t){console.error("Load "+e+" error :"+JSON.stringify(t,null,"  "))},o.open("GET",e,!0),o.send(null)}return{getCamera:function(t,e){o(t,e)},getBodies:function(t,e){o(t,e)},getLights:function(t,e){o(t,e)}}}();function SolarSystem(){"use strict";var e,o={},t={addMoon:r,addPlanet:n,addStar:s,init:function(t){e=new SolarProperties(t),i.init(e),SolarService.getCamera(e.cameraSrc,h),SolarService.getBodies(e.bodiesSrc,d),SolarService.getLights(e.lightsSrc,c)}},i=new SceneBuilder;return t;function a(t){(o[t.name]=t).orbitProperties?o[t.orbitProperties.round].addSatellite(t):i.addObject(t)}function r(t){a(SolarFactory.createMoon(t))}function n(t){a(SolarFactory.createPlanet(t))}function s(t){a(SolarFactory.createStar(t))}function h(t){var e=SceneFactory.createCamera(t);i.setCamera(e);var o=SceneFactory.createControls(e,t.controls);i.setControls(o),i.animate()}function d(t){t.forEach(function(t){switch(t.type){case"Star":s(t);break;case"Planet":case"Dwarf Planet":n(t);break;case"Moon":r(t);break;default:return void console.error(t.type+" is not considered a kind of solar body")}})}function c(t){t.forEach(function(t){var e=SceneFactory.createLight(t);i.addObject(e)})}}THREE.RingsGeometry=function(t,e,o,i,a,r){THREE.Geometry.call(this),this.type="RingsGeometry",this.innerRadius=t||0,this.outerRadius=e||50,this.thetaStart=void 0!==o?o:0,this.thetaLength=void 0!==i?i:2*Math.PI,this.thetaSegments=void 0!==a?Math.max(3,a):50,this.phiSegments=void 0!==r?Math.max(1,r):50;var n,s,h,d=[],c=this.innerRadius,p=(e-t)/this.phiSegments;for(n=0;n<this.phiSegments+1;n++){for(s=0;s<this.thetaSegments+1;s++){var E=new THREE.Vector3;h=this.thetaStart+s/this.thetaSegments*this.thetaLength,E.x=c*Math.cos(h),E.y=c*Math.sin(h),this.vertices.push(E),d.push(new THREE.Vector2(n/(this.thetaSegments-1),s/(this.phiSegments-1)))}c+=p}var l=new THREE.Vector3(0,0,1);for(n=0;n<this.phiSegments;n++){var u=n*(this.thetaSegments+1);for(s=0;s<this.thetaSegments;s++){var R=h=s+u,T=h+this.thetaSegments+1,y=h+this.thetaSegments+2;this.faces.push(new THREE.Face3(R,T,y,[l.clone(),l.clone(),l.clone()])),this.faceVertexUvs[0].push([d[R].clone(),d[T].clone(),d[y].clone()]),T=(R=h)+this.thetaSegments+2,y=h+1,this.faces.push(new THREE.Face3(R,T,y,[l.clone(),l.clone(),l.clone()])),this.faceVertexUvs[0].push([d[R].clone(),d[T].clone(),d[y].clone()])}}this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,c)},THREE.RingsGeometry.prototype=Object.create(THREE.RingGeometry.prototype),THREE.RingsGeometry.prototype.constructor=THREE.RingsGeometry,THREE.CloudsMesh=function(t){THREE.SolarBody.call(this,t),this.type=t&&t.type||"CloudsMesh",this.radius=t&&t.radius||20,this.opacity=t&&t.opacity||.5,this.transparent=t&&t.transparent||!0,this.depthWrite=t&&t.depthWrite||!1,this.speed=t&&t.speed||.2,this.geometry=new THREE.SphereGeometry(this.radius,100,100)},THREE.CloudsMesh.prototype=Object.create(THREE.SolarBody.prototype),THREE.CloudsMesh.prototype.constructor=THREE.CloudsMesh,THREE.CloudsMesh.prototype.loadTexture=function(t){this.material=new THREE.MeshPhongMaterial({map:t,side:THREE.DoubleSide,opacity:this.opacity,transparent:this.transparent,depthWrite:this.depthWrite})},THREE.CloudsMesh.prototype.update=function(){this.rotation.x-=THREE.Math.randFloat(0,this.speed)*Math.PI/180,this.rotation.y-=THREE.Math.randFloat(0,this.speed)*Math.PI/180},THREE.MoonMesh=function(t){this.type=t&&t.type||"MoonMesh",THREE.PlanetMesh.call(this,t)},THREE.MoonMesh.prototype=Object.create(THREE.PlanetMesh.prototype),THREE.MoonMesh.prototype.constructor=THREE.MoonMesh,THREE.OrbitMesh=function(t){THREE.Object3D.call(this),this.name=t&&t.name,this.type=t&&t.type||"OrbitMesh",this.distance=t&&t.distance||50,this.speed=t&&t.speed||0,this.tilt=t&&t.tilt||0},THREE.OrbitMesh.prototype=Object.create(THREE.Object3D.prototype),THREE.OrbitMesh.prototype.constructor=THREE.OrbitMesh,THREE.OrbitMesh.prototype.update=function(){for(var t in this.rotation.y-=this.speed*Math.PI/180,this.children)this.children[t].update()},THREE.RingsMesh=function(t){THREE.SolarBody.call(this,t),this.type=t&&t.type||"RingsMesh",this.tilt=t&&t.tilt||0,this.rotation.x=(90-this.tilt)*Math.PI/180,this.vRotation=t&&t.vRotation||0,this.geometry=new THREE.RingsGeometry(t&&t.innerRadius,t&&t.outerRadius,t&&t.thetaStart,t&&t.thetaLength,t&&t.thetaSegments,t&&t.phiSegments)},THREE.RingsMesh.prototype=Object.create(THREE.SolarBody.prototype),THREE.RingsMesh.prototype.constructor=THREE.RingsMesh,THREE.RingsMesh.prototype.update=function(){this.rotation.y-=this.vRotation*Math.PI/180},THREE.RingsMesh.prototype.loadTexture=function(t){this.material=new THREE.MeshPhongMaterial({map:t,side:THREE.DoubleSide})},THREE.StarMesh=function(t){THREE.SolarBody.call(this,t),this.type=t&&t.type||"StarMesh",this.radius=t&&t.radius||50,this.rotation.x=t&&t.tilt||0,this.vRotation=t&&t.vRotation||0,this.intesity=t&&t.intensity||.8,this.geometry=new THREE.SphereGeometry(this.radius||50,100,100);var o=new THREE.PointLight(16777215,1.5,4500);o.update=function(t){for(var e in o.children)o.children[e].update&&o.children[e].update(t)},this.add(o),this.createLensFlare()},THREE.StarMesh.prototype=Object.create(THREE.SolarBody.prototype),THREE.StarMesh.prototype.constructor=THREE.StarMesh,THREE.StarMesh.prototype.createLensFlare=function(){var e=2*this.radius*this.intesity,t=new THREE.Color(16777215),o=new THREE.LensFlare(t),i=new THREE.TextureLoader;i.load("img/sun/lensflare1.png",function(t){o.add(t,16*e,0,THREE.AdditiveBlending)}),i.load("img/sun/lensflare2.png",function(t){o.add(t,16*e,0,THREE.AdditiveBlending)}),i.load("img/sun/lensflare3.png",function(t){o.add(t,16*e,0,THREE.AdditiveBlending)}),i.load("img/sun/lensflare4.png",function(t){o.add(t,64*e,0,THREE.AdditiveBlending)}),o.position=this.position,o.update=function(t,e){if(t){var o=t.position.distanceTo(e.position);for(var i in this.lensFlares)this.lensFlares[i].position=e.position,this.lensFlares[i].scale=this.lensFlares[i].size/o}this.updateLensFlares()},this.add(o),this.hasLensFlare=!0},THREE.StarMesh.prototype.loadTexture=function(t){this.material=new THREE.MeshBasicMaterial({map:t,side:THREE.BackSide})};