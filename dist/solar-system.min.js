/*
 * solar-system
 * @Description Solar System with Threejs
 * @version v0.1.45 - 2018-09-08
 * @link https://github.com/kdaimiel/solar-system#readme
 * @author Enrique Daimiel Ruiz <k.daimiel@gmail.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
function SceneBuilder(){"use strict";function a(a){i=a}function b(a){h.add(a),i&&(i.aspect=(l||window.innerWidth)/(m||window.innerHeight),i.updateProjectionMatrix())}function c(a){(k=a)&&k.addEventListener&&k.addEventListener("change",d)}function d(){j.render(h,i)}function e(a){h=new THREE.Scene,a&&(l=a.width||null,m=a.height||null),k&&k.addEventListener("change",d),j=new THREE.WebGLRenderer({alpha:!0}),j.setSize(l||window.innerWidth,m||window.innerHeight),document.body.appendChild(j.domElement),window.addEventListener("resize",g,!1)}function f(){if(!h)throw new TypeError("Scene has to be initiated before animate");requestAnimationFrame(f);for(var a in h.children)h.children[a].update&&h.children[a].update(i);k&&k.update(),d()}function g(){i&&(i.aspect=(l||window.innerWidth)/(m||window.innerHeight),i.updateProjectionMatrix()),j.setSize(l||window.innerWidth,m||window.innerHeight),k&&k.handleResize()}var h,i,j,k,l,m;return{addObject:b,animate:f,setCamera:a,setControls:c,init:e}}function SolarProperties(a){"use strict";return{width:a&&a.width,height:a&&a.height,bodiesSrc:a&&a.bodiesSrc||"data/bodies.properties.json",cameraSrc:a&&a.cameraSrc||"data/camera.properties.json",lightsSrc:a&&a.lightsSrc||"data/lights.properties.json"}}function SolarSystem(){"use strict";function a(a){j=new SolarProperties(a),m.init(j),f()}function b(a){k[a.name]=a,a.orbitProperties?k[a.orbitProperties.round].addSatellite(a):m.addObject(a)}function c(a){b(SolarFactory.createMoon(a))}function d(a){b(SolarFactory.createPlanet(a))}function e(a){b(SolarFactory.createStar(a))}function f(){SolarService.getCamera(j.cameraSrc,g),SolarService.getBodies(j.bodiesSrc,h),SolarService.getLights(j.lightsSrc,i)}function g(a){var b=SceneFactory.createCamera(a);m.setCamera(b);var c=SceneFactory.createControls(b,a.controls);m.setControls(c),m.animate()}function h(a){a.forEach(function(a){switch(a.type){case"Star":e(a);break;case"Planet":case"Dwarf Planet":d(a);break;case"Moon":c(a);break;default:return void console.error(a.type+" is not considered a kind of solar body")}})}function i(a){a.forEach(function(a){var b=SceneFactory.createLight(a);m.addObject(b)})}var j,k={},l={addMoon:c,addPlanet:d,addStar:e,init:a},m=new SceneBuilder;return l}THREE.SolarBody=function(a){THREE.Object3D.call(this),this.geometry=new THREE.SphereGeometry(5,32,32),this.material=new THREE.MeshBasicMaterial,a&&(this.name=a.name,this.type=a.type,a.map&&this.texloader.load(a.map,this.loadTexture.bind(this)),a.bumpMap&&this.texloader.load(a.bumpMap,this.loadbumpMap.bind(this)),a.specularMap&&this.texloader.load(a.specularMap,this.loadspecularMap.bind(this)),this.orbitProperties=a.orbitProperties,a.cloudsProperties&&this.addClouds(a.cloudsProperties),a.ringsProperties&&this.addRings(a.ringsProperties)),this.drawMode=THREE.TrianglesDrawMode,this.updateMorphTargets()},THREE.SolarBody.prototype=Object.create(THREE.Mesh.prototype),THREE.SolarBody.prototype.constructor=THREE.SolarBody,THREE.SolarBody.prototype.addClouds=function(a){this.add(new THREE.CloudsMesh(a))},THREE.SolarBody.prototype.addRings=function(a){this.add(new THREE.RingsMesh(a))},THREE.SolarBody.prototype.addSatellite=function(a){var b=new THREE.OrbitMesh(a.orbitProperties);a.orbit=b,this.orbit?(this.orbit.add(b),b.position.z=this.position.z||0):this.parent&&this.parent.add(b),b.add(a),a.position.z=this.radius+b.distance+a.radius||0},THREE.SolarBody.prototype.loadTexture=function(a){this.material=new THREE.MeshPhongMaterial({map:a,side:THREE.DoubleSide})},THREE.SolarBody.prototype.loadbumpMap=function(a){this.material.bumpMap=a},THREE.SolarBody.prototype.loadspecularMap=function(a){this.material.specularMap=a},THREE.SolarBody.prototype.update=function(a){this.rotation.y-=this.vRotation*Math.PI/180;for(var b in this.children)this.children[b].update(a,this)},THREE.SolarBody.prototype.texloader=new THREE.TextureLoader,THREE.PlanetMesh=function(a){THREE.SolarBody.call(this,a),this.type=a&&a.type||"PlanetMesh",this.radius=a&&a.radius||50,this.rotation.x=a&&a.tilt||0,this.vRotation=a&&a.vRotation||0,this.geometry=new THREE.SphereGeometry(this.radius||50,100,100)},THREE.PlanetMesh.prototype=Object.create(THREE.SolarBody.prototype),THREE.PlanetMesh.prototype.constructor=THREE.PlanetMesh,THREE.RingsGeometry=function(a,b,c,d,e,f){THREE.Geometry.call(this),this.type="RingsGeometry",this.innerRadius=a||0,this.outerRadius=b||50,this.thetaStart=void 0!==c?c:0,this.thetaLength=void 0!==d?d:2*Math.PI,this.thetaSegments=void 0!==e?Math.max(3,e):50,this.phiSegments=void 0!==f?Math.max(1,f):50;var g,h,i,j=[],k=this.innerRadius,l=(b-a)/this.phiSegments;for(g=0;g<this.phiSegments+1;g++){for(h=0;h<this.thetaSegments+1;h++){var m=new THREE.Vector3;i=this.thetaStart+h/this.thetaSegments*this.thetaLength,m.x=k*Math.cos(i),m.y=k*Math.sin(i),this.vertices.push(m),j.push(new THREE.Vector2(g/(this.thetaSegments-1),h/(this.phiSegments-1)))}k+=l}var n=new THREE.Vector3(0,0,1);for(g=0;g<this.phiSegments;g++){var o=g*(this.thetaSegments+1);for(h=0;h<this.thetaSegments;h++){i=h+o;var p=i,q=i+this.thetaSegments+1,r=i+this.thetaSegments+2;this.faces.push(new THREE.Face3(p,q,r,[n.clone(),n.clone(),n.clone()])),this.faceVertexUvs[0].push([j[p].clone(),j[q].clone(),j[r].clone()]),p=i,q=i+this.thetaSegments+2,r=i+1,this.faces.push(new THREE.Face3(p,q,r,[n.clone(),n.clone(),n.clone()])),this.faceVertexUvs[0].push([j[p].clone(),j[q].clone(),j[r].clone()])}}this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,k)},THREE.RingsGeometry.prototype=Object.create(THREE.RingGeometry.prototype),THREE.RingsGeometry.prototype.constructor=THREE.RingsGeometry,THREE.CloudsMesh=function(a){THREE.SolarBody.call(this,a),this.type=a&&a.type||"CloudsMesh",this.radius=a&&a.radius||20,this.opacity=a&&a.opacity||.5,this.transparent=a&&a.transparent||!0,this.depthWrite=a&&a.depthWrite||!1,this.speed=a&&a.speed||.2,this.geometry=new THREE.SphereGeometry(this.radius,100,100)},THREE.CloudsMesh.prototype=Object.create(THREE.SolarBody.prototype),THREE.CloudsMesh.prototype.constructor=THREE.CloudsMesh,THREE.CloudsMesh.prototype.loadTexture=function(a){this.material=new THREE.MeshPhongMaterial({map:a,side:THREE.DoubleSide,opacity:this.opacity,transparent:this.transparent,depthWrite:this.depthWrite})},THREE.CloudsMesh.prototype.update=function(){this.rotation.x-=THREE.Math.randFloat(0,this.speed)*Math.PI/180,this.rotation.y-=THREE.Math.randFloat(0,this.speed)*Math.PI/180},THREE.MoonMesh=function(a){this.type=a&&a.type||"MoonMesh",THREE.PlanetMesh.call(this,a)},THREE.MoonMesh.prototype=Object.create(THREE.PlanetMesh.prototype),THREE.MoonMesh.prototype.constructor=THREE.MoonMesh,THREE.OrbitMesh=function(a){THREE.Object3D.call(this),this.name=a&&a.name,this.type=a&&a.type||"OrbitMesh",this.distance=a&&a.distance||50,this.speed=a&&a.speed||0,this.tilt=a&&a.tilt||0},THREE.OrbitMesh.prototype=Object.create(THREE.Object3D.prototype),THREE.OrbitMesh.prototype.constructor=THREE.OrbitMesh,THREE.OrbitMesh.prototype.update=function(){this.rotation.y-=this.speed*Math.PI/180;for(var a in this.children)this.children[a].update()},THREE.RingsMesh=function(a){THREE.SolarBody.call(this,a),this.type=a&&a.type||"RingsMesh",this.tilt=a&&a.tilt||0,this.rotation.x=(90-this.tilt)*Math.PI/180,this.vRotation=a&&a.vRotation||0,this.geometry=new THREE.RingsGeometry(a&&a.innerRadius,a&&a.outerRadius,a&&a.thetaStart,a&&a.thetaLength,a&&a.thetaSegments,a&&a.phiSegments)},THREE.RingsMesh.prototype=Object.create(THREE.SolarBody.prototype),THREE.RingsMesh.prototype.constructor=THREE.RingsMesh,THREE.RingsMesh.prototype.update=function(){this.rotation.y-=this.vRotation*Math.PI/180},THREE.RingsMesh.prototype.loadTexture=function(a){this.material=new THREE.MeshPhongMaterial({map:a,side:THREE.DoubleSide})},THREE.StarMesh=function(a){THREE.SolarBody.call(this,a),this.type=a&&a.type||"StarMesh",this.radius=a&&a.radius||50,this.rotation.x=a&&a.tilt||0,this.vRotation=a&&a.vRotation||0,this.intesity=a&&a.intensity||.8,this.geometry=new THREE.SphereGeometry(this.radius||50,100,100);var b=new THREE.PointLight(16777215,1.5,4500);b.update=function(a){for(var c in b.children)b.children[c].update&&b.children[c].update(a)},this.add(b),this.createLensFlare()},THREE.StarMesh.prototype=Object.create(THREE.SolarBody.prototype),THREE.StarMesh.prototype.constructor=THREE.StarMesh,THREE.StarMesh.prototype.createLensFlare=function(){var a=2*this.radius*this.intesity,b=new THREE.Color(16777215),c=new THREE.LensFlare(b),d=new THREE.TextureLoader;d.load("img/sun/lensflare1.png",function(b){c.add(b,16*a,0,THREE.AdditiveBlending)}),d.load("img/sun/lensflare2.png",function(b){c.add(b,16*a,0,THREE.AdditiveBlending)}),d.load("img/sun/lensflare3.png",function(b){c.add(b,16*a,0,THREE.AdditiveBlending)}),d.load("img/sun/lensflare4.png",function(b){c.add(b,64*a,0,THREE.AdditiveBlending)}),c.position=this.position,c.update=function(a,b){if(a){var c=a.position.distanceTo(b.position);for(var d in this.lensFlares)this.lensFlares[d].position=b.position,this.lensFlares[d].scale=this.lensFlares[d].size/c}this.updateLensFlares()},this.add(c),this.hasLensFlare=!0},THREE.StarMesh.prototype.loadTexture=function(a){this.material=new THREE.MeshBasicMaterial({map:a,side:THREE.BackSide})};var SceneFactory=function(){"use strict";return{createCamera:function(a){var b;switch(a.aspect=a.aspect||window.innerWidth/window.innerHeight,a.type){case"PerspectiveCamera":b=new THREE.PerspectiveCamera(a.fov,a.aspect,a.near,a.far);break;case"CubeCamera":b=new THREE.CubeCamera(a.near,a.far,a.cubeResolution);break;case"OrthographicCamera":b=new THREE.OrthographicCamera(a.left,a.right,a.top,a.bottom,a.near,a.far);break;default:throw new TypeError(a.type+" is not a kind of valid camera")}return a.position&&(b.position.x=a.position.x||0,b.position.y=a.position.y||0,b.position.z=a.position.z||0),b.zoom=a.zoom||1,b},createControls:function(a,b){var c;switch(b){case"TrackballControls":c=new THREE.TrackballControls(a);break;case"DeviceOrientationControls":c=new THREE.DeviceOrientationControls(a);break;case"FlyControls":c=new THREE.FlyControls(a);break;case"OrbitControls":c=new THREE.OrbitControls(a);break;case"PointerLockControls":c=new THREE.PointerLockControls(a);break;case"TransformControls":c=new THREE.TransformControls(a);break;default:throw new TypeError(b+" is not a kind of valid camera controls")}return c},createLight:function(a){var b,c=new THREE.Color(a.hexColor)||16777215;switch(a.type){case"AmbientLight":b=new THREE.AmbientLight(c);break;case"DirectionalLight":b=new THREE.DirectionalLight(c,a.intensity||.5);break;case"HemisphereLight":b=new THREE.HemisphereLight(a.skyColor||16777147,a.groundColor||526368,a.intensity||1);break;case"PointLight":b=new THREE.PointLight(c,a.intensity||1,a.distance||0,a.decay||1);break;case"SpotLight":b=new THREE.SpotLight(c,a.intensity||1,a.distance||0,a.angle||Math.PI/3,a.exponent||10,a.decay||1),b.castShadow=a.castShadow||!1,b.shadow.camera.near=a.shadowCameraNear||50,b.shadow.camera.far=a.shadowCameraFar||5e3,b.shadow.camera.left=a.shadowCameraLeft||-500,b.shadow.camera.right=a.shadowCameraRight||500,b.shadow.camera.top=a.shadowCameraTop||500,b.shadow.camera.bottom=a.shadowCameraBottom||-500,a.shadowCameraVisible&&THREE.CameraHelper(b.shadow.camera),b.shadow.bias=a.shadowBias||0,b.shadow.mapSize.width=a.shadowMapWidth||512,b.shadow.mapSize.height=a.shadowMapHeight||512,b.shadowMapSize=a.shadowMapSize,b.shadowCamera=a.shadowCamera,b.shadowMatrix=a.shadowMatrix,b.shadowMap=a.shadowMap;break;default:throw new TypeError(a.type+" is not a kind of valid light")}return a.position&&b.position.set(a.position.x||0,a.position.y||0,a.position.z||0),b}}}(),SolarFactory=function(){"use strict";return{createMoon:function(a){return new THREE.MoonMesh(a)},createPlanet:function(a){return new THREE.PlanetMesh(a)},createStar:function(a){return new THREE.StarMesh(a)}}}(),SolarService=function(){"use strict";function a(a,b){var c=new XMLHttpRequest;c.onreadystatechange=function(){4===c.readyState&&(200===c.status?b(JSON.parse(c.responseText)):c.status>=400&&console.error("Load "+a+" error, status: "+c.status))},c.onerror=function(b){console.error("Load "+a+" error :"+JSON.stringify(b,null,"  "))},c.open("GET",a,!0),c.send(null)}return{getCamera:function(b,c){a(b,c)},getBodies:function(b,c){a(b,c)},getLights:function(b,c){a(b,c)}}}();